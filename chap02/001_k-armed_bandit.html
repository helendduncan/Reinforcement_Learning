

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>The k-armed bandit from the book &#8212; Reinforcement Learning</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chap02/001_k-armed_bandit';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/abstract.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/abstract.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Reinforcement Learning: An overview:
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapter 2</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="restaurant_too.html">1.1 Multi-armed bandits: 3 restaurants</a></li>




<li class="toctree-l1"><a class="reference internal" href="ch2_questions.html">Chapter 2 selected questions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapter 3</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../chap03/ch3_comments.html">Markov Decision Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chap03/ch3_questions.html">Chapter 3 selected questions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Q-Learning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../qlearning/qlearning.html">Using Q-learning on a classic control problem</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chap02/001_k-armed_bandit.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>The k-armed bandit from the book</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-10-armed-testbed">2.3 The 10-armed Testbed</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="the-k-armed-bandit-from-the-book">
<h1>The k-armed bandit from the book<a class="headerlink" href="#the-k-armed-bandit-from-the-book" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<section id="the-10-armed-testbed">
<h2>2.3 The 10-armed Testbed<a class="headerlink" href="#the-10-armed-testbed" title="Permalink to this heading">#</a></h2>
<p>Initially we want to pick k random numbers from a normal distrubution with mean, mu = 0, and sigma = 1. Note that each time we pick we will pick a new set of k random numbers. These values will be the action values, q*(a) shown in figure 2.1</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bandit_001</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A way to get the initial distributions for the ten-armed bandit</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Default values are k = 10, mu = 0; sigma = 1</span>
    <span class="n">action_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="c1"># An empty array to put the ten initial distributions in</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="c1"># Use the caluclated value of q*(a)for each of the ten bandits as the average for a new distribution</span>
        <span class="c1"># Use 500 sample points for each normal distribution</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">action_values</span><span class="p">[</span><span class="n">_</span><span class="p">],</span> <span class="n">sigma</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="n">bp</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">showextrema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">showmeans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;The 10-armed Testbed - optimal run = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">action_values</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Action&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Reward Distribution&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="n">action_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">av</span> <span class="o">=</span> <span class="n">bandit_001</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0c32cde0150f2e3d54a8881855c5335709842a95c1e8b4ccb2006035de050dd7.png" src="../_images/0c32cde0150f2e3d54a8881855c5335709842a95c1e8b4ccb2006035de050dd7.png" />
</div>
</div>
<p>The bandit_001 function returns the list of action values for the k-armed bandit. That is the values of q*(a) for each distribution.</p>
<p>The next step is to run an experiment over 1000 time steps (or pulls of the arm) utilising firstly a greedy approach, then moving onto an epsilon-greedy approach. Note this cycle of a thousand counts as one run</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Agent</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Chooses actions randomly and updates estimates (using sample average)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">initial_value</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_value</span> <span class="o">=</span> <span class="n">initial_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_estimates</span> <span class="o">=</span> <span class="n">initial_value</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_attempts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_action</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_value</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_estimates</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_attempts</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_action</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test1</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
[0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
[0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
0
None
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_001</span><span class="p">(</span><span class="n">action_values</span><span class="p">,</span> <span class="n">nsteps</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Running a greedy experiment for 1000 time steps</span>
<span class="sd">    In this example we take the action values from the initial bandit experiment, (bandit_001)</span>
<span class="sd">    next the distribution with the highest/largest mu is picked. </span>
<span class="sd">    Finally 1000 samples are taken from this distribution. The average reward is worked out at each step</span>
<span class="sd">    and is plotted and the experimental action value recalculated at each step</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">experiment_action_values</span> <span class="o">=</span> <span class="n">action_values</span>
    <span class="n">greedy_dist</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">experiment_action_values</span><span class="p">)</span> <span class="c1"># Find the distribution with the highest/largest mu</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">action_values</span><span class="p">)</span>
    <span class="n">greedy_mu</span><span class="o">=</span><span class="n">experiment_action_values</span><span class="p">[</span><span class="n">greedy_dist</span><span class="p">]</span> <span class="c1"># Pull the value of mu from it</span>
    <span class="n">sum_of_rewards</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">running_average</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># Make a new sample distribution with that mu and nsteps data points in it</span>
    <span class="n">sample_distribution</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">greedy_mu</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">nsteps</span><span class="p">)</span> 
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsteps</span><span class="p">):</span>
        <span class="n">sum_of_rewards</span><span class="o">=</span><span class="n">sum_of_rewards</span> <span class="o">+</span> <span class="n">sample_distribution</span><span class="p">[</span><span class="n">_</span><span class="p">]</span>
        <span class="n">running_average</span><span class="o">=</span><span class="n">sample_average</span><span class="p">(</span><span class="n">sum_of_rewards</span><span class="p">,</span> <span class="n">_</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;After running for </span><span class="si">{</span><span class="n">nsteps</span><span class="si">}</span><span class="s1"> steps, the sample average for distribution </span><span class="si">{</span><span class="n">greedy_dist</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">running_average</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">, while the actual average is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">greedy_mu</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">sample_average</span><span class="p">(</span><span class="n">sum_rewards</span><span class="p">,</span> <span class="n">times_taken</span><span class="p">):</span>
    <span class="n">updated_average</span> <span class="o">=</span> <span class="n">sum_rewards</span><span class="o">/</span><span class="n">times_taken</span>
    <span class="k">return</span> <span class="n">updated_average</span>
    
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run_001</span><span class="p">(</span><span class="n">av</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">av</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 0.17840626  1.35839954  0.21040642  1.04299234  0.0344865   1.12603402
 -2.02469212  0.7823951   0.49123274  0.84902269]
After running for 1000 steps, the sample average for distribution 1 is 1.36, while the actual average is 1.36
[ 0.17840626  1.35839954  0.21040642  1.04299234  0.0344865   1.12603402
 -2.02469212  0.7823951   0.49123274  0.84902269]
</pre></div>
</div>
</div>
</div>
<p>Before I get to the experiment though I want to try out a few basic options for the bandit class.
Here I have defined a Bandit001 which will be defined based on one normal distribution.
It takes in the number of steps (or pulls), an initial estimate for the rolling average (I think this is not actually needed as an argument though, I could just put it in the <strong>init</strong> block. It also takes in a value for the target mu for the normal distribution. (note target mu defaults to 3.5 if no number is given)</p>
<p>Firstly I set an array for the trial results and for the computed average for each step and set them to be nsteps in size and filled with zeros</p>
<p>Next I define a function called est. This is a function that will use the calculation for efficiently estimating the average after n steps sampling from a normal distribution outlined in equation 2.3 in the book.
The function returns the new estimate, the list of the random numbers picked from the normal distribution and the average calculated at each step.</p>
<p>Finally I plot the data just to have a look at it and make sure it seems sensible. In this case the blue circles are the randomly chosen values from the normal distribution with mu=target_mu, and the orange line is the average as calculated at each time step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Bandit001</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">old_est</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">targ_mu</span><span class="o">=</span><span class="mf">3.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_est</span> <span class="o">=</span> <span class="n">old_est</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targ_mu</span> <span class="o">=</span> <span class="n">targ_mu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_est</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">avs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">est</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A function to estimate the average using the calculations from 2.3&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">):</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targ_mu</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_est</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_est</span> <span class="o">+</span> <span class="p">((</span><span class="n">target</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">old_est</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">old_est</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">new_est</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+=</span> <span class="n">target</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">avs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_est</span>
        <span class="n">new_est</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_est</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_est</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">avs</span>
    
    <span class="k">def</span> <span class="nf">plotty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A function to plot the result of the average estimation&quot;&quot;&quot;</span>
        <span class="n">x</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">))</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Trial Values&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">avs</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Estimated Average&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">targ_mu</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sampling and getting running averages&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of samples&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Score&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">targ_mu</span><span class="o">=</span><span class="mf">4.3</span>
<span class="n">bandit</span> <span class="o">=</span> <span class="n">Bandit001</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">targ_mu</span><span class="o">=</span><span class="n">targ_mu</span><span class="p">)</span>
<span class="n">est_av</span><span class="p">,</span> <span class="n">trials</span><span class="p">,</span> <span class="n">avs</span> <span class="o">=</span> <span class="n">bandit</span><span class="o">.</span><span class="n">est</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;After </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">trials</span><span class="p">)</span><span class="si">}</span><span class="s1"> runs, the estimated average is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">est_av</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1">, while the actual average is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">targ_mu</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">bandit</span><span class="o">.</span><span class="n">plotty</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>After 100 runs, the estimated average is 4.3, while the actual average is 4.3
</pre></div>
</div>
<img alt="../_images/1e0a3249310c089d43f160934b05de971e6b9dff9d13d2a35dc73475e697b142.png" src="../_images/1e0a3249310c089d43f160934b05de971e6b9dff9d13d2a35dc73475e697b142.png" />
</div>
</div>
<p>Now instead of running this for just one target value, I want to run it for a range of target q*(a) values, specifically the ones I calculated/determined earlier in the page. Lets call this Bandit002</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Bandit002</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">action_values</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="o">=</span><span class="n">steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_values</span><span class="o">=</span><span class="n">action_values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_est</span><span class="o">=</span><span class="n">action_values</span> <span class="c1">#This is where the updates of the action values go</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_estimate</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">action_values</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">action_values</span><span class="p">))</span> <span class="c1">#Count how many pulls there have been</span>
        
        
    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull the lever for however many steps are needed&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimal_pos</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_values</span><span class="p">)</span> <span class="c1">#Position of the highest action value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulls</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">optimal_pos</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1">#Increment the counting list</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pulls</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_est</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">optimal_pos</span><span class="p">])</span>
            <span class="c1">#target=np.random.normal(self.update_est[self.optimal_pos])</span>
            <span class="c1">#self.update_est[self.optimal_pos] = self.old_estimate[self.optimal_pos] + \</span>
            <span class="c1">#self.pulls[self.optimal_pos]*(target-self.old_estimate[self.optimal_pos])</span>
            
        <span class="c1">#print(self.update_est)</span>
        <span class="nb">print</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_est</span><span class="p">])</span>
        <span class="c1">#print(self.pulls)</span>
        <span class="c1">#print(self.optimal_pos)</span>
    
        
    <span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">update_est</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">optimal_pos</span><span class="p">]</span>
        <span class="n">old_est</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">old_estimate</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">optimal_pos</span><span class="p">]</span>
        <span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pulls</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">optimal_pos</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="n">old_est</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">action_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">b2</span><span class="o">=</span><span class="n">Bandit002</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">action_values</span><span class="p">)</span>

<span class="nb">print</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">action_values</span><span class="p">])</span>
<span class="n">b2</span><span class="o">.</span><span class="n">pull</span><span class="p">()</span>
<span class="n">b2</span><span class="o">.</span><span class="n">average</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2.1, -0.07, -0.03, 0.16, -0.12, 0.47, -1.3, -0.35, -1.36, -1.17]
[1. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
0 2.095741922137221
[2. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
1 2.095741922137221
[3. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
2 2.095741922137221
[4. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
3 2.095741922137221
[5. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
4 2.095741922137221
[6. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
5 2.095741922137221
[7. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
6 2.095741922137221
[8. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
7 2.095741922137221
[9. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
8 2.095741922137221
[10.  0.  0.  0.  0.  0.  0.  0.  0.  0.]
9 2.095741922137221
[2.1, -0.07, -0.03, 0.16, -0.12, 0.47, -1.3, -0.35, -1.36, -1.17]
2.095741922137221 0.0 10.0
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chap02"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-10-armed-testbed">2.3 The 10-armed Testbed</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Helen Duncan
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>