
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The k-armed bandit from the book &#8212; Reinforcement Learning</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/abstract.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Reinforcement Learning</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Reinforcement Learning: An overview:
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapter 2
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="restaurant_too.html">
   1.1 Multi-armed bandits: 3 restaurants
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ch2_questions.html">
   Chapter 2 selected questions
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapter 3
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../chap03/ch3_comments.html">
   Markov Decision Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chap03/ch3_questions.html">
   Chapter 3 selected questions
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/chap02/001_k-armed_bandit.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/main?urlpath=tree/docs/chap02/001_k-armed_bandit.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-10-armed-testbed">
   2.3 The 10-armed Testbed
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>The k-armed bandit from the book</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-10-armed-testbed">
   2.3 The 10-armed Testbed
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="the-k-armed-bandit-from-the-book">
<h1>The k-armed bandit from the book<a class="headerlink" href="#the-k-armed-bandit-from-the-book" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-10-armed-testbed">
<h2>2.3 The 10-armed Testbed<a class="headerlink" href="#the-10-armed-testbed" title="Permalink to this headline">¶</a></h2>
<p>Initially we want to pick k random numbers from a normal distrubution with mean, mu = 0, and sigma = 1. Note that each time we pick we will pick a new set of k random numbers. These values will be the action values, q*(a) shown in figure 2.1</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bandit_001</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A way to get the initial distributions for the ten-armed bandit</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Default values are k = 10, mu = 0; sigma = 1</span>
    <span class="n">action_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="c1"># An empty array to put the ten initial distributions in</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="c1"># Use the caluclated value of q*(a)for each of the ten bandits as the average for a new distribution</span>
        <span class="c1"># Use 500 sample points for each normal distribution</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">action_values</span><span class="p">[</span><span class="n">_</span><span class="p">],</span> <span class="n">sigma</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="n">bp</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">showextrema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">showmeans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;The 10-armed Testbed - optimal run = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">action_values</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Action&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Reward Distribution&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="n">action_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">av</span> <span class="o">=</span> <span class="n">bandit_001</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/001_k-armed_bandit_5_0.png" src="../_images/001_k-armed_bandit_5_0.png" />
</div>
</div>
<p>The bandit_001 function returns the list of action values for the k-armed bandit. That is the values of q*(a) for each distribution.</p>
<p>The next step is to run an experiment over 1000 time steps (or pulls of the arm) utilising firstly a greedy approach, then moving onto an epsilon-greedy approach. Note this cycle of a thousand counts as one run</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Agent</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Chooses actions randomly and updates estimates (using sample average)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">initial_value</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_value</span> <span class="o">=</span> <span class="n">initial_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_estimates</span> <span class="o">=</span> <span class="n">initial_value</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_attempts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_action</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_value</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_estimates</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_attempts</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_action</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test1</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
[0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
[0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
0
None
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_001</span><span class="p">(</span><span class="n">action_values</span><span class="p">,</span> <span class="n">nsteps</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Running a greedy experiment for 1000 time steps</span>
<span class="sd">    In this example we take the action values from the initial bandit experiment, (bandit_001)</span>
<span class="sd">    next the distribution with the highest/largest mu is picked. </span>
<span class="sd">    Finally 1000 samples are taken from this distribution. The average reward is worked out at each step</span>
<span class="sd">    and is plotted and the experimental action value recalculated at each step</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">experiment_action_values</span> <span class="o">=</span> <span class="n">action_values</span>
    <span class="n">greedy_dist</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">experiment_action_values</span><span class="p">)</span> <span class="c1"># Find the distribution with the highest/largest mu</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">action_values</span><span class="p">)</span>
    <span class="n">greedy_mu</span><span class="o">=</span><span class="n">experiment_action_values</span><span class="p">[</span><span class="n">greedy_dist</span><span class="p">]</span> <span class="c1"># Pull the value of mu from it</span>
    <span class="n">sum_of_rewards</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">running_average</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># Make a new sample distribution with that mu and nsteps data points in it</span>
    <span class="n">sample_distribution</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">greedy_mu</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">nsteps</span><span class="p">)</span> 
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsteps</span><span class="p">):</span>
        <span class="n">sum_of_rewards</span><span class="o">=</span><span class="n">sum_of_rewards</span> <span class="o">+</span> <span class="n">sample_distribution</span><span class="p">[</span><span class="n">_</span><span class="p">]</span>
        <span class="n">running_average</span><span class="o">=</span><span class="n">sample_average</span><span class="p">(</span><span class="n">sum_of_rewards</span><span class="p">,</span> <span class="n">_</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;After running for </span><span class="si">{</span><span class="n">nsteps</span><span class="si">}</span><span class="s1"> steps, the sample average for distribution </span><span class="si">{</span><span class="n">greedy_dist</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">running_average</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">, while the actual average is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">greedy_mu</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">sample_average</span><span class="p">(</span><span class="n">sum_rewards</span><span class="p">,</span> <span class="n">times_taken</span><span class="p">):</span>
    <span class="n">updated_average</span> <span class="o">=</span> <span class="n">sum_rewards</span><span class="o">/</span><span class="n">times_taken</span>
    <span class="k">return</span> <span class="n">updated_average</span>
    
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run_001</span><span class="p">(</span><span class="n">av</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">av</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 1.86119589 -0.2653887  -0.4165206  -0.41328238  0.98522872  0.65951874
 -0.17282028  0.10590261 -0.71649808  0.93555795]
After running for 1000 steps, the sample average for distribution 0 is 1.83, while the actual average is 1.86
[ 1.86119589 -0.2653887  -0.4165206  -0.41328238  0.98522872  0.65951874
 -0.17282028  0.10590261 -0.71649808  0.93555795]
</pre></div>
</div>
</div>
</div>
<p>Before I get to the experiment though I want to try out a few basic options for the bandit class.
Here I have defined a Bandit001 which will be defined based on one normal distribution.
It takes in the number of steps (or pulls), an initial estimate for the rolling average (I think this is not actually needed as an argument though, I could just put it in the <strong>init</strong> block. It also takes in a value for the target mu for the normal distribution. (note target mu defaults to 3.5 if no number is given)</p>
<p>Firstly I set an array for the trial results and for the computed average for each step and set them to be nsteps in size and filled with zeros</p>
<p>Next I define a function called est. This is a function that will use the calculation for efficiently estimating the average after n steps sampling from a normal distribution outlined in equation 2.3 in the book.
The function returns the new estimate, the list of the random numbers picked from the normal distribution and the average calculated at each step.</p>
<p>Finally I plot the data just to have a look at it and make sure it seems sensible. In this case the blue circles are the randomly chosen values from the normal distribution with mu=target_mu, and the orange line is the average as calculated at each time step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Bandit001</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">old_est</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">targ_mu</span><span class="o">=</span><span class="mf">3.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_est</span> <span class="o">=</span> <span class="n">old_est</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targ_mu</span> <span class="o">=</span> <span class="n">targ_mu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_est</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">avs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">est</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A function to estimate the average using the calculations from 2.3&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">):</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targ_mu</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_est</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_est</span> <span class="o">+</span> <span class="p">((</span><span class="n">target</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">old_est</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">old_est</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">new_est</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+=</span> <span class="n">target</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">avs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_est</span>
        <span class="n">new_est</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_est</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_est</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">avs</span>
    
    <span class="k">def</span> <span class="nf">plotty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A function to plot the result of the average estimation&quot;&quot;&quot;</span>
        <span class="n">x</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">))</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Trial Values&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">avs</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Estimated Average&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">targ_mu</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sampling and getting running averages&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of samples&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Score&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">targ_mu</span><span class="o">=</span><span class="mf">4.3</span>
<span class="n">bandit</span> <span class="o">=</span> <span class="n">Bandit001</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">targ_mu</span><span class="o">=</span><span class="n">targ_mu</span><span class="p">)</span>
<span class="n">est_av</span><span class="p">,</span> <span class="n">trials</span><span class="p">,</span> <span class="n">avs</span> <span class="o">=</span> <span class="n">bandit</span><span class="o">.</span><span class="n">est</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;After </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">trials</span><span class="p">)</span><span class="si">}</span><span class="s1"> runs, the estimated average is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">est_av</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1">, while the actual average is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">targ_mu</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">bandit</span><span class="o">.</span><span class="n">plotty</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>After 100 runs, the estimated average is 4.4, while the actual average is 4.3
</pre></div>
</div>
<img alt="../_images/001_k-armed_bandit_14_1.png" src="../_images/001_k-armed_bandit_14_1.png" />
</div>
</div>
<p>Now instead of running this for just one target value, I want to run it for a range of target q*(a) values, specifically the ones I calculated/determined earlier in the page. Lets call this Bandit002</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Bandit002</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">action_values</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="o">=</span><span class="n">steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_values</span><span class="o">=</span><span class="n">action_values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_est</span><span class="o">=</span><span class="n">action_values</span> <span class="c1">#This is where the updates of the action values go</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_estimate</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">action_values</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">action_values</span><span class="p">))</span> <span class="c1">#Count how many pulls there have been</span>
        
        
    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pull the lever for however many steps are needed&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimal_pos</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_values</span><span class="p">)</span> <span class="c1">#Position of the highest action value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulls</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">optimal_pos</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1">#Increment the counting list</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pulls</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_est</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">optimal_pos</span><span class="p">])</span>
            <span class="c1">#target=np.random.normal(self.update_est[self.optimal_pos])</span>
            <span class="c1">#self.update_est[self.optimal_pos] = self.old_estimate[self.optimal_pos] + \</span>
            <span class="c1">#self.pulls[self.optimal_pos]*(target-self.old_estimate[self.optimal_pos])</span>
            
        <span class="c1">#print(self.update_est)</span>
        <span class="nb">print</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_est</span><span class="p">])</span>
        <span class="c1">#print(self.pulls)</span>
        <span class="c1">#print(self.optimal_pos)</span>
    
        
    <span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">update_est</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">optimal_pos</span><span class="p">]</span>
        <span class="n">old_est</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">old_estimate</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">optimal_pos</span><span class="p">]</span>
        <span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pulls</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">optimal_pos</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="n">old_est</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">action_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">b2</span><span class="o">=</span><span class="n">Bandit002</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">action_values</span><span class="p">)</span>

<span class="nb">print</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">action_values</span><span class="p">])</span>
<span class="n">b2</span><span class="o">.</span><span class="n">pull</span><span class="p">()</span>
<span class="n">b2</span><span class="o">.</span><span class="n">average</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-0.23, -0.34, 0.74, 0.74, 2.6, -0.87, 1.7, -0.72, -0.84, -1.65]
[0. 0. 0. 0. 1. 0. 0. 0. 0. 0.]
0 2.595942340175572
[0. 0. 0. 0. 2. 0. 0. 0. 0. 0.]
1 2.595942340175572
[0. 0. 0. 0. 3. 0. 0. 0. 0. 0.]
2 2.595942340175572
[0. 0. 0. 0. 4. 0. 0. 0. 0. 0.]
3 2.595942340175572
[0. 0. 0. 0. 5. 0. 0. 0. 0. 0.]
4 2.595942340175572
[0. 0. 0. 0. 6. 0. 0. 0. 0. 0.]
5 2.595942340175572
[0. 0. 0. 0. 7. 0. 0. 0. 0. 0.]
6 2.595942340175572
[0. 0. 0. 0. 8. 0. 0. 0. 0. 0.]
7 2.595942340175572
[0. 0. 0. 0. 9. 0. 0. 0. 0. 0.]
8 2.595942340175572
[ 0.  0.  0.  0. 10.  0.  0.  0.  0.  0.]
9 2.595942340175572
[-0.23, -0.34, 0.74, 0.74, 2.6, -0.87, 1.7, -0.72, -0.84, -1.65]
2.595942340175572 0.0 10.0
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chap02"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Helen Duncan<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>