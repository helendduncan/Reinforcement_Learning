
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The 10 armed bandit problem &#8212; Reinforcement Learning</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/abstract.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Reinforcement Learning</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Reinforcement Learning: An overview:
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapter 2
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="restaurant_too.html">
   1.1 Multi-armed bandits: 3 restaurants
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ch2_questions.html">
   Chapter 2 selected questions
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapter 3
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../chap03/ch3_comments.html">
   Markov Decision Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chap03/ch3_questions.html">
   Chapter 3 selected questions
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/chap02/nov_10_armed_bandit.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/main?urlpath=tree/docs/chap02/nov_10_armed_bandit.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   The 10 armed bandit problem
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#start-again-this-time-working-as-outlined-on-page-68-of-lab-book-2">
   Start again: This time working as outlined on page 68 of lab book #2
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>The 10 armed bandit problem</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   The 10 armed bandit problem
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#start-again-this-time-working-as-outlined-on-page-68-of-lab-book-2">
   Start again: This time working as outlined on page 68 of lab book #2
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="the-10-armed-bandit-problem">
<h1>The 10 armed bandit problem<a class="headerlink" href="#the-10-armed-bandit-problem" title="Permalink to this headline">¶</a></h1>
<p>Initially we pick k (10) values from a normal distribution with mu = 0 and sigma = 1</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">secrets</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">setup_bandit</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="n">action_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">action_values</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">greedy_actual_reward</span><span class="p">(</span><span class="n">action_values</span><span class="p">):</span>
    <span class="n">opt_arm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">action_values</span><span class="p">)</span>
    <span class="n">reward</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">action_values</span><span class="p">[</span><span class="n">opt_arm</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">reward</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">sample_average</span><span class="p">(</span><span class="n">sum_rewards</span><span class="p">,</span> <span class="n">npulls</span><span class="p">):</span>
    <span class="n">updated_average</span> <span class="o">=</span> <span class="n">sum_rewards</span><span class="o">/</span><span class="n">npulls</span>
    <span class="k">return</span><span class="p">(</span><span class="n">updated_average</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">run_experiment</span><span class="p">(</span><span class="n">action_values</span><span class="p">,</span> <span class="n">npulls</span><span class="p">):</span>
    <span class="n">results_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npulls</span><span class="p">)</span>
    <span class="n">counter</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">sum_rewards</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npulls</span><span class="p">):</span>
        <span class="n">Rt</span> <span class="o">=</span> <span class="n">greedy_actual_reward</span><span class="p">(</span><span class="n">action_values</span><span class="p">)</span>
        <span class="n">sum_rewards</span> <span class="o">+=</span> <span class="n">Rt</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">average</span> <span class="o">=</span> <span class="n">sample_average</span><span class="p">(</span><span class="n">sum_rewards</span><span class="p">,</span> <span class="n">counter</span><span class="p">)</span>
        <span class="n">results_array</span><span class="p">[</span><span class="n">_</span><span class="p">]</span> <span class="o">=</span> <span class="n">average</span>
    <span class="k">return</span><span class="p">(</span><span class="n">average</span><span class="p">,</span> <span class="n">results_array</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">run_lots_of_experiments</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">npulls</span><span class="p">,</span> <span class="n">nexperiments</span><span class="p">):</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nexperiments</span><span class="p">)</span>
    <span class="n">counter</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">sum_rewards</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nexperiments</span><span class="p">):</span>
        <span class="n">action_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="c1"># Generate a new set of 10-armed bandits for each experiment</span>
        <span class="n">experiment_result</span><span class="p">,</span> <span class="n">average_array</span> <span class="o">=</span> <span class="n">run_experiment</span><span class="p">(</span><span class="n">action_values</span><span class="p">,</span> <span class="n">npulls</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="n">_</span><span class="p">]</span> <span class="o">=</span> <span class="n">experiment_result</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">av</span><span class="o">=</span><span class="n">setup_bandit</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Action Values = &quot;</span><span class="p">,</span><span class="n">av</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The best arm is #&quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">av</span><span class="p">),</span> <span class="s2">&quot;which gives a value of &quot;</span> <span class="p">,</span> <span class="n">av</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">av</span><span class="p">)])</span>
<span class="n">npulls</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">average_reward</span><span class="p">,</span> <span class="n">average_array</span> <span class="o">=</span> <span class="n">run_experiment</span><span class="p">(</span><span class="n">av</span><span class="p">,</span> <span class="n">npulls</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;For one run,the average reward is&quot;</span><span class="p">,</span> <span class="n">average_reward</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Action Values =  [ 1.01714663  1.1233231  -0.92444866  1.11571786 -1.78657792 -1.04312561
  1.06445586 -0.06719563 -0.60812152 -0.53867308]
The best arm is # 1 which gives a value of  1.123323100487258
For one run,the average reward is 1.1373681000086817
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">average_array</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">average_array</span><span class="p">))</span>
<span class="c1"># Plot the results of one run of a thousand pulls...</span>
<span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">average_array</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span><span class="o">=</span><span class="n">average_array</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Results from one run of epsilon greedy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X axis&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Y axis&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.52524728 0.92885995 1.20175914 1.34175015 1.2214149  1.35647686
 1.2876772  1.13361267 1.0588207  1.02226129 1.14081511 1.15657643
 1.0849405  1.05995755 1.01526574 1.03056509 1.03537181 1.06268861
 1.0333531  0.99582472 1.01043362 1.04405358 1.0140193  1.01606675
 1.06032253 1.08461091 1.06193892 1.08519528 1.13733121 1.15894643
 1.18344024 1.12202879 1.10603908 1.15107423 1.14558906 1.13974617
 1.14530474 1.10884597 1.12499396 1.12236165 1.12505822 1.11423641
 1.10596591 1.05848209 1.06369934 1.0415747  1.05262347 1.0692553
 1.0582796  1.04225117 1.0495721  1.06629653 1.05949498 1.05763697
 1.06228611 1.06306836 1.09251071 1.08302332 1.06934345 1.06636776
 1.07086723 1.08106047 1.06046594 1.07536103 1.07620589 1.08317242
 1.09189389 1.10536337 1.09791552 1.09732783 1.10959116 1.11694507
 1.11445109 1.0948545  1.08590975 1.11399235 1.13061426 1.13947652
 1.13569146 1.13934227 1.14591957 1.14159235 1.12343081 1.12658158
 1.12832386 1.13392351 1.1392537  1.13916063 1.13689896 1.13611684
 1.12831192 1.13737479 1.14090207 1.14930472 1.13472861 1.14535286
 1.14850428 1.15138985 1.15188163 1.14618196 1.14916773 1.16377749
 1.15155412 1.14793658 1.14439314 1.15325667 1.14724435 1.14457781
 1.14132499 1.15337528 1.168251   1.18715878 1.19883043 1.18860662
 1.18271356 1.19060962 1.18244635 1.17935454 1.17865448 1.16781918
 1.17363875 1.16127179 1.15974852 1.15641408 1.16266563 1.15988713
 1.155554   1.16983718 1.1688066  1.17422717 1.17004179 1.16569334
 1.1638901  1.15718593 1.14999267 1.13936496 1.14398873 1.13942075
 1.13945999 1.13473402 1.14921601 1.13891791 1.151052   1.14292148
 1.15525682 1.15537599 1.1533492  1.16186359 1.1655398  1.16084619
 1.16778577 1.16467591 1.1647548  1.17030859 1.17005065 1.16869606
 1.17765771 1.18849495 1.18629242 1.18962062 1.18762474 1.18490005
 1.19120157 1.1866805  1.19034361 1.18398793 1.17873127 1.17975245
 1.18123223 1.17188782 1.17903681 1.18360232 1.18114554 1.17656673
 1.1701274  1.16174048 1.15600929 1.16060591 1.15906934 1.14899813
 1.1524164  1.150074   1.1469202  1.1494078  1.15043334 1.13987231
 1.13170346 1.131741   1.13420884 1.13763793 1.12411273 1.12309757
 1.12790333 1.12629731 1.12408293 1.1134936  1.10838794 1.1076928
 1.10503886 1.10182482 1.09847469 1.1045731  1.10703443 1.10420775
 1.10351852 1.10042656 1.09984006 1.09793585 1.09306827 1.09141371
 1.09555077 1.10293245 1.10558328 1.10761873 1.11038227 1.10810293
 1.11277533 1.11431551 1.10888212 1.10844594 1.11344799 1.1108143
 1.10872584 1.11536885 1.11869569 1.12013611 1.12845938 1.12826604
 1.12840238 1.12806206 1.12685115 1.13132345 1.12521909 1.11453022
 1.11528632 1.10929846 1.10046266 1.09456817 1.10143711 1.10350739
 1.1092724  1.10400557 1.09793936 1.09565135 1.09852191 1.08935493
 1.08695185 1.09023369 1.0956349  1.10242786 1.10320518 1.10677687
 1.11003811 1.10822844 1.11136914 1.12232227 1.12426494 1.12258242
 1.13150538 1.13311677 1.13725735 1.13543586 1.13958884 1.14539802
 1.145969   1.14955603 1.1525238  1.15205429 1.15981809 1.16045711
 1.15869698 1.15214907 1.1503666  1.14601552 1.15342079 1.15508089
 1.14767992 1.14772686 1.15079859 1.1537813  1.15374069 1.14998253
 1.15611983 1.15681053 1.15891358 1.15725564 1.16467128 1.16838731
 1.16444523 1.16101998 1.1591608  1.158674   1.1594034  1.16030593
 1.15594494 1.15633035 1.15284718 1.15827726 1.16156658 1.16535348
 1.16090364 1.16123104 1.15957796 1.1567751  1.16034004 1.1592021
 1.15796166 1.1539284  1.15375225 1.15265629 1.15262062 1.15050869
 1.15050676 1.14920423 1.14597217 1.14679629 1.14595355 1.1456139
 1.14703864 1.14755251 1.14594288 1.14807726 1.15413876 1.15426635
 1.16250592 1.16746907 1.16981498 1.16783475 1.16463672 1.16377938
 1.15901112 1.15776546 1.15693135 1.1580565  1.15562597 1.1612483
 1.16694602 1.1670633  1.16419125 1.16403652 1.17411171 1.17291087
 1.17437277 1.17400657 1.17531583 1.1768794  1.17917657 1.18162381
 1.18288684 1.18090337 1.17985132 1.17714927 1.1725083  1.17444118
 1.17452629 1.17577253 1.17666895 1.17633955 1.17543838 1.17786419
 1.18252183 1.18492836 1.1851525  1.18759143 1.18404986 1.18060417
 1.1785173  1.18217465 1.18438324 1.18515273 1.1827948  1.18002497
 1.17907837 1.17795006 1.18106414 1.18190083 1.18244708 1.17486448
 1.17332443 1.17129524 1.17389655 1.1741342  1.17640344 1.17752908
 1.17476343 1.17544849 1.17676578 1.17353346 1.17313453 1.17314697
 1.17256549 1.17167009 1.16978733 1.16821838 1.16926351 1.17103038
 1.16944774 1.17143914 1.16947408 1.16794917 1.16661065 1.16051262
 1.15707337 1.15718791 1.15511717 1.15884383 1.15778872 1.15739849
 1.15471822 1.15478238 1.15350556 1.15544261 1.15893779 1.15923807
 1.15868274 1.15896474 1.15743714 1.1579713  1.15683968 1.16070995
 1.15741929 1.16024077 1.16068488 1.1625597  1.16286247 1.16315474
 1.16353841 1.16828741 1.16663516 1.1647282  1.16477744 1.16539138
 1.16476384 1.16869318 1.16289922 1.16590507 1.16571795 1.16563657
 1.1622979  1.16220529 1.16084845 1.1598863  1.15975607 1.15790752
 1.15748481 1.15660432 1.15619983 1.15666212 1.15588948 1.15645791
 1.15610115 1.15232439 1.15473654 1.15511978 1.15659807 1.15477603
 1.15323103 1.15334704 1.15649418 1.15489296 1.15318414 1.1525537
 1.15034986 1.14811778 1.14832861 1.14365894 1.14498415 1.14236414
 1.1408909  1.14297595 1.14819965 1.15320328 1.1498957  1.14789283
 1.14353841 1.14383057 1.14245344 1.14820686 1.14614443 1.14831352
 1.15000331 1.15033314 1.14955113 1.14902139 1.14623167 1.14792644
 1.14870085 1.1466     1.14865776 1.14958418 1.14723243 1.15040632
 1.15033205 1.14937244 1.14904809 1.15019486 1.15419572 1.15494798
 1.15579945 1.15611321 1.15871266 1.16120811 1.16069415 1.16300685
 1.16411792 1.16108308 1.16144221 1.16054091 1.15951896 1.15733046
 1.15727359 1.15669317 1.15302564 1.15081889 1.15423314 1.15248953
 1.14989868 1.14637198 1.15107589 1.15079382 1.14915626 1.14773845
 1.14669318 1.14766889 1.14866604 1.1472578  1.14927734 1.14788849
 1.15050158 1.14947917 1.15168208 1.15253491 1.15191286 1.15284599
 1.15364301 1.15428191 1.15305692 1.1537501  1.15341442 1.15138582
 1.15048457 1.14953534 1.14911385 1.15428979 1.15208478 1.15129903
 1.15222465 1.15363315 1.15267314 1.15356029 1.15084107 1.152057
 1.15186614 1.15173344 1.1529951  1.15098401 1.15139319 1.15245826
 1.15324068 1.15445672 1.15715504 1.15574457 1.15418575 1.15710394
 1.15967403 1.16020326 1.16157365 1.16051362 1.15964842 1.16212
 1.15707727 1.15665087 1.15885498 1.15831313 1.15333392 1.15431873
 1.15294428 1.15449626 1.1530676  1.15585628 1.15587582 1.15403917
 1.15317198 1.1552035  1.15555199 1.1575712  1.15562659 1.15596891
 1.15598039 1.15385297 1.1562404  1.15354537 1.15436612 1.15279224
 1.15478267 1.15414421 1.15358639 1.15053459 1.14728341 1.14941803
 1.14898796 1.1479477  1.14889166 1.15039926 1.15163586 1.15206111
 1.15255347 1.15063782 1.15203999 1.15280173 1.15501548 1.15430889
 1.15546835 1.15492851 1.15634428 1.15820183 1.16082633 1.15973104
 1.16045646 1.16162358 1.16279874 1.16210155 1.16150513 1.1608448
 1.16227786 1.16262172 1.16261748 1.16239534 1.16145144 1.16402183
 1.16711698 1.16851599 1.16885394 1.16835266 1.16982322 1.16981625
 1.16959425 1.16916688 1.16994784 1.1691879  1.16863221 1.17072318
 1.17231907 1.17108672 1.17311391 1.17326503 1.1708801  1.1689578
 1.16973452 1.16754825 1.16420392 1.16304431 1.16564659 1.1642242
 1.16190096 1.16161989 1.16310616 1.16313882 1.16521648 1.16871969
 1.17159061 1.1718297  1.1726064  1.17150768 1.16895816 1.17088816
 1.17211753 1.17456416 1.175862   1.17323784 1.17201705 1.17026325
 1.17077717 1.16932431 1.17154898 1.17203996 1.17301343 1.1733576
 1.17470327 1.17368846 1.17306264 1.17337494 1.17331196 1.17398987
 1.17323103 1.17402642 1.17771367 1.17657124 1.17636804 1.17578619
 1.17627013 1.17505964 1.1743527  1.1756545  1.17805524 1.17921805
 1.17907006 1.17875175 1.17646882 1.17912364 1.18009487 1.17722618
 1.17783388 1.17867913 1.17633105 1.17606844 1.17506711 1.17492592
 1.1736955  1.17298518 1.1727109  1.17270161 1.1723548  1.17435681
 1.17467584 1.17489752 1.174184   1.17329823 1.17253408 1.17070439
 1.17255116 1.17374472 1.17202961 1.17240594 1.16950228 1.16967578
 1.16813166 1.16955891 1.17297757 1.17043037 1.16901669 1.1695959
 1.16920892 1.1704995  1.16882858 1.17030261 1.16961113 1.16891225
 1.16859279 1.16747708 1.16922183 1.1687732  1.16831708 1.1667071
 1.16493633 1.16303295 1.1628402  1.16468049 1.16568907 1.1656857
 1.16744908 1.16672831 1.16829817 1.167391   1.16549919 1.16477849
 1.16578716 1.16461259 1.16493318 1.16390984 1.16525007 1.16574344
 1.16543153 1.16617012 1.16595881 1.16477947 1.16315305 1.16317679
 1.1622952  1.16357066 1.16511003 1.16420819 1.16655784 1.16432771
 1.16574518 1.16792296 1.16892085 1.16899122 1.16741391 1.16720286
 1.16826367 1.16678678 1.16715006 1.16599247 1.16406794 1.16483911
 1.16483166 1.16502987 1.16389817 1.16311081 1.16342621 1.16383064
 1.16576441 1.16671622 1.16625191 1.16693015 1.16617121 1.16581128
 1.16649102 1.16635795 1.16575913 1.16383191 1.16357793 1.16312109
 1.16055197 1.15868318 1.15850848 1.15861999 1.1592744  1.15747792
 1.15666518 1.15526373 1.15524712 1.1529911  1.15332672 1.15480829
 1.15628052 1.1559595  1.15400748 1.15478589 1.15330662 1.15133718
 1.15061085 1.14991489 1.149158   1.15077757 1.15038329 1.14982163
 1.14952387 1.14980021 1.15067357 1.1514892  1.15125788 1.15108839
 1.15088848 1.14945548 1.14724829 1.14668058 1.14688235 1.14491908
 1.14691355 1.14608323 1.14501885 1.14527854 1.14463298 1.14078421
 1.14102763 1.14073343 1.14074683 1.13843017 1.14022591 1.14028486
 1.13845549 1.13688907 1.1364553  1.13934353 1.13998997 1.13755786
 1.13704858 1.13582013 1.13451433 1.13616706 1.13385312 1.13304231
 1.1341512  1.13321268 1.1339414  1.13495443 1.13436479 1.13287746
 1.13164885 1.13092017 1.13125839 1.13174667 1.12963012 1.1291084
 1.12820546 1.12709266 1.1264669  1.12737868 1.13002083 1.12973654
 1.13023441 1.13040137 1.13113262 1.13104195 1.13174686 1.13149418
 1.13079856 1.12998108 1.12766187 1.12699501 1.1283368  1.12761094
 1.12758013 1.12577399 1.12700535 1.12885834 1.12867087 1.12760575
 1.12734904 1.1275475  1.12763079 1.12841768 1.12905784 1.12913847
 1.12927437 1.12720819 1.12843113 1.12722852 1.12842446 1.12888128
 1.12794285 1.12786134 1.12644975 1.12662626 1.12710933 1.12905509
 1.13111285 1.13050416 1.13151958 1.13281347 1.13246559 1.1328719
 1.13213057 1.13242006 1.13363032 1.13300699 1.13222781 1.13349068
 1.13201766 1.13285906 1.13217398 1.1349255  1.13477868 1.13306495
 1.13273503 1.13331799 1.13337035 1.13487382 1.13539301 1.13245852
 1.13409637 1.13476258 1.1349067  1.13453861 1.13427075 1.1342136
 1.13367045 1.13359686 1.13284232 1.13402507 1.13306188 1.13246072
 1.1325612  1.13235005 1.13062033 1.13040404 1.13174275 1.130813
 1.13143441 1.1320441  1.13287455 1.13291493 1.13240844 1.13175555
 1.13050414 1.13095323 1.13195607 1.1330301  1.13420875 1.13218661
 1.13263784 1.13182898 1.1332761  1.13312845 1.13254723 1.13120765
 1.13005841 1.13171727 1.13303832 1.13254517 1.13229748 1.13283012
 1.1327406  1.13483155 1.13416639 1.13507603 1.13464698 1.13712389
 1.13849883 1.13764768 1.13662971 1.13736681 1.13786341 1.13620924
 1.13750717 1.13620198 1.13560103 1.1373681 ] 1000
[   1    2    3    4    5    6    7    8    9   10   11   12   13   14
   15   16   17   18   19   20   21   22   23   24   25   26   27   28
   29   30   31   32   33   34   35   36   37   38   39   40   41   42
   43   44   45   46   47   48   49   50   51   52   53   54   55   56
   57   58   59   60   61   62   63   64   65   66   67   68   69   70
   71   72   73   74   75   76   77   78   79   80   81   82   83   84
   85   86   87   88   89   90   91   92   93   94   95   96   97   98
   99  100  101  102  103  104  105  106  107  108  109  110  111  112
  113  114  115  116  117  118  119  120  121  122  123  124  125  126
  127  128  129  130  131  132  133  134  135  136  137  138  139  140
  141  142  143  144  145  146  147  148  149  150  151  152  153  154
  155  156  157  158  159  160  161  162  163  164  165  166  167  168
  169  170  171  172  173  174  175  176  177  178  179  180  181  182
  183  184  185  186  187  188  189  190  191  192  193  194  195  196
  197  198  199  200  201  202  203  204  205  206  207  208  209  210
  211  212  213  214  215  216  217  218  219  220  221  222  223  224
  225  226  227  228  229  230  231  232  233  234  235  236  237  238
  239  240  241  242  243  244  245  246  247  248  249  250  251  252
  253  254  255  256  257  258  259  260  261  262  263  264  265  266
  267  268  269  270  271  272  273  274  275  276  277  278  279  280
  281  282  283  284  285  286  287  288  289  290  291  292  293  294
  295  296  297  298  299  300  301  302  303  304  305  306  307  308
  309  310  311  312  313  314  315  316  317  318  319  320  321  322
  323  324  325  326  327  328  329  330  331  332  333  334  335  336
  337  338  339  340  341  342  343  344  345  346  347  348  349  350
  351  352  353  354  355  356  357  358  359  360  361  362  363  364
  365  366  367  368  369  370  371  372  373  374  375  376  377  378
  379  380  381  382  383  384  385  386  387  388  389  390  391  392
  393  394  395  396  397  398  399  400  401  402  403  404  405  406
  407  408  409  410  411  412  413  414  415  416  417  418  419  420
  421  422  423  424  425  426  427  428  429  430  431  432  433  434
  435  436  437  438  439  440  441  442  443  444  445  446  447  448
  449  450  451  452  453  454  455  456  457  458  459  460  461  462
  463  464  465  466  467  468  469  470  471  472  473  474  475  476
  477  478  479  480  481  482  483  484  485  486  487  488  489  490
  491  492  493  494  495  496  497  498  499  500  501  502  503  504
  505  506  507  508  509  510  511  512  513  514  515  516  517  518
  519  520  521  522  523  524  525  526  527  528  529  530  531  532
  533  534  535  536  537  538  539  540  541  542  543  544  545  546
  547  548  549  550  551  552  553  554  555  556  557  558  559  560
  561  562  563  564  565  566  567  568  569  570  571  572  573  574
  575  576  577  578  579  580  581  582  583  584  585  586  587  588
  589  590  591  592  593  594  595  596  597  598  599  600  601  602
  603  604  605  606  607  608  609  610  611  612  613  614  615  616
  617  618  619  620  621  622  623  624  625  626  627  628  629  630
  631  632  633  634  635  636  637  638  639  640  641  642  643  644
  645  646  647  648  649  650  651  652  653  654  655  656  657  658
  659  660  661  662  663  664  665  666  667  668  669  670  671  672
  673  674  675  676  677  678  679  680  681  682  683  684  685  686
  687  688  689  690  691  692  693  694  695  696  697  698  699  700
  701  702  703  704  705  706  707  708  709  710  711  712  713  714
  715  716  717  718  719  720  721  722  723  724  725  726  727  728
  729  730  731  732  733  734  735  736  737  738  739  740  741  742
  743  744  745  746  747  748  749  750  751  752  753  754  755  756
  757  758  759  760  761  762  763  764  765  766  767  768  769  770
  771  772  773  774  775  776  777  778  779  780  781  782  783  784
  785  786  787  788  789  790  791  792  793  794  795  796  797  798
  799  800  801  802  803  804  805  806  807  808  809  810  811  812
  813  814  815  816  817  818  819  820  821  822  823  824  825  826
  827  828  829  830  831  832  833  834  835  836  837  838  839  840
  841  842  843  844  845  846  847  848  849  850  851  852  853  854
  855  856  857  858  859  860  861  862  863  864  865  866  867  868
  869  870  871  872  873  874  875  876  877  878  879  880  881  882
  883  884  885  886  887  888  889  890  891  892  893  894  895  896
  897  898  899  900  901  902  903  904  905  906  907  908  909  910
  911  912  913  914  915  916  917  918  919  920  921  922  923  924
  925  926  927  928  929  930  931  932  933  934  935  936  937  938
  939  940  941  942  943  944  945  946  947  948  949  950  951  952
  953  954  955  956  957  958  959  960  961  962  963  964  965  966
  967  968  969  970  971  972  973  974  975  976  977  978  979  980
  981  982  983  984  985  986  987  988  989  990  991  992  993  994
  995  996  997  998  999 1000] 1000 1000
1000
</pre></div>
</div>
<img alt="../_images/nov_10_armed_bandit_5_1.png" src="../_images/nov_10_armed_bandit_5_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nexperiments</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">multi_exp</span> <span class="o">=</span> <span class="n">run_lots_of_experiments</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">npulls</span><span class="p">,</span> <span class="n">nexperiments</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1.21811435 1.90309084 2.19676308 ... 0.8070046  1.06052204 2.66800141]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">multi_exp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1.21811435 1.90309084 2.19676308 ... 0.8070046  1.06052204 2.66800141]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">multi_exp_sample_av</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nexperiments</span><span class="p">)</span>
<span class="n">counter</span><span class="o">=</span><span class="mi">0</span>
<span class="n">sum_rewards</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">multi_exp</span><span class="p">):</span>
    <span class="n">sum_rewards</span> <span class="o">+=</span> <span class="n">value</span>
    <span class="n">multi_exp_output</span> <span class="o">=</span> <span class="n">sample_average</span><span class="p">(</span><span class="n">sum_rewards</span><span class="p">,</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">multi_exp_sample_av</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_exp_output</span>
<span class="c1">#     print(count + 1, value, multi_exp_output, sum_rewards)</span>
  
<span class="nb">print</span><span class="p">(</span><span class="n">multi_exp_sample_av</span><span class="p">)</span>

<span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nexperiments</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi_exp_sample_av</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">y</span><span class="o">=</span><span class="n">multi_exp_sample_av</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Line graph&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X axis&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Y axis&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">multi_exp</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1.21811435 1.56060259 1.77265609 ... 1.54432657 1.54408455 1.5446465 ]
[   1    2    3 ... 1998 1999 2000] 2000 2000
</pre></div>
</div>
<img alt="../_images/nov_10_armed_bandit_8_1.png" src="../_images/nov_10_armed_bandit_8_1.png" />
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="start-again-this-time-working-as-outlined-on-page-68-of-lab-book-2">
<h1>Start again: This time working as outlined on page 68 of lab book #2<a class="headerlink" href="#start-again-this-time-working-as-outlined-on-page-68-of-lab-book-2" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get initial distribution for first experiment</span>
<span class="n">k</span><span class="o">=</span><span class="mi">10</span>
<span class="n">action_value_mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">action_value_mu</span><span class="p">)</span>
<span class="n">n_array</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">action_value_mu</span><span class="p">))</span>
<span class="n">estimate_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">action_value_mu</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">n_array</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-0.18699602 -0.20501378 -0.43521895 -0.323872    1.71386987 -0.54962715
  0.07751893 -1.71318304  0.95697514 -1.93653826]
[0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_bandit</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate a k-armed bandit as outlines in the book&quot;&quot;&quot;</span>
    <span class="n">action_value_mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">action_value_mu</span>
    
<span class="k">def</span> <span class="nf">pick_arm</span><span class="p">(</span><span class="n">action_value_mu</span><span class="p">,</span> <span class="n">estimate_array</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">):</span>
    <span class="n">k</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">estimate_array</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">estimate_array</span><span class="p">):</span> <span class="c1">#If the array is full of zeros then just pick an arm at random</span>
        <span class="n">choice</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="c1">#         print(&quot;all zeros&quot;)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Greedy and non-greedy choices</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">-</span><span class="n">epsilon</span><span class="p">:</span> <span class="c1">#Explore</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="c1">#             print(&quot;explore&quot;)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1">#Exploit</span>
            <span class="n">maxval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">estimate_array</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">maxval</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">choice</span> <span class="o">=</span> <span class="n">exploit_pick_neg_or_zeroes</span><span class="p">(</span><span class="n">estimate_array</span><span class="p">)</span>
                <span class="c1">#If all the non-zero values are &lt; 0 then pick a random zero value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">choice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">estimate_array</span><span class="p">)</span>  <span class="c1">#If there is one non-zero value (&gt;0) then pick that.           </span>
<span class="c1">#             print(&quot;exploit&quot;)</span>
<span class="c1">#     print(&quot;pick arm&quot;, choice)</span>
    <span class="n">mu</span><span class="o">=</span><span class="n">action_value_mu</span><span class="p">[</span><span class="n">choice</span><span class="p">]</span>
    <span class="n">Rt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">n_array</span><span class="p">[</span><span class="n">choice</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">estimate_array</span><span class="p">[</span><span class="n">choice</span><span class="p">]</span> <span class="o">=</span> <span class="n">update_estimate_array</span><span class="p">(</span><span class="n">Rt</span><span class="p">,</span> <span class="n">estimate_array</span><span class="p">[</span><span class="n">choice</span><span class="p">],</span> <span class="n">n_array</span><span class="p">[</span><span class="n">choice</span><span class="p">])</span>
    <span class="k">return</span><span class="p">(</span><span class="n">estimate_array</span><span class="p">,</span> <span class="n">Rt</span><span class="p">)</span>
 
<span class="k">def</span> <span class="nf">exploit_pick_neg_or_zeroes</span><span class="p">(</span><span class="n">estimate_array</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Take the estimate array, if all values are below 0 then pick the least negative one</span>
<span class="sd">    if some values are zero, and others below, pick a random zero from the contenders&quot;&quot;&quot;</span>
    <span class="n">contenders</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">estimate_array</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contenders</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">estimate_array</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">contenders</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">choice</span>
    
<span class="k">def</span> <span class="nf">update_estimate_array</span><span class="p">(</span><span class="n">Rt</span><span class="p">,</span> <span class="n">previous_value</span><span class="p">,</span> <span class="n">n_pulls</span><span class="p">):</span>
    <span class="n">updated_values</span> <span class="o">=</span> <span class="n">previous_value</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">n_pulls</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Rt</span> <span class="o">-</span> <span class="n">previous_value</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">updated_values</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">reset_estimate_and_n_array</span><span class="p">(</span><span class="n">action_value_mu</span><span class="p">):</span>
    <span class="n">estimate_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">action_value_mu</span><span class="p">))</span>
    <span class="n">n_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">action_value_mu</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">estimate_array</span><span class="p">,</span> <span class="n">n_array</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_experiment</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">npulls</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate a k-armed bandit and pull the lever npull times&quot;&quot;&quot;</span>
    <span class="n">action_value_mu</span> <span class="o">=</span> <span class="n">generate_bandit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="c1">#     print(action_value_mu)</span>
    <span class="n">estimate_array</span><span class="p">,</span> <span class="n">n_array</span> <span class="o">=</span> <span class="n">reset_estimate_and_n_array</span><span class="p">(</span><span class="n">action_value_mu</span><span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npulls</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npulls</span><span class="p">):</span>
        <span class="n">estimate_array</span><span class="p">,</span> <span class="n">reward</span> <span class="o">=</span> <span class="n">pick_arm</span><span class="p">(</span><span class="n">action_value_mu</span><span class="p">,</span> <span class="n">estimate_array</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span> <span class="c1">#epsilon=0 means greedy</span>
<span class="c1">#         print(_, np.around(estimate_array,2), np.around(reward,4))</span>
        <span class="n">scores</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">=</span><span class="n">reward</span>
<span class="c1">#     print(scores)</span>
<span class="c1">#     print(estimate_array)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">estimate_array</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_multiple_exp</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">npulls</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">nexp</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nexp</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">old_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npulls</span><span class="p">)</span>
        <span class="n">new_scores</span><span class="p">,</span> <span class="n">estimate_array</span> <span class="o">=</span> <span class="n">run_experiment</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">npulls</span><span class="o">=</span><span class="n">npulls</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="n">epsilon</span><span class="p">)</span>
        <span class="n">average_scores</span> <span class="o">=</span> <span class="n">scores_averaging</span><span class="p">(</span><span class="n">old_scores</span><span class="p">,</span><span class="n">new_scores</span><span class="p">,</span><span class="n">nexp</span><span class="p">)</span>
        <span class="n">old_scores</span> <span class="o">=</span> <span class="n">new_scores</span>
    <span class="k">return</span> <span class="n">average_scores</span>

<span class="k">def</span> <span class="nf">scores_averaging</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">nexp</span><span class="p">):</span>
    <span class="n">new_av</span> <span class="o">=</span> <span class="n">old</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">nexp</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">new</span><span class="o">-</span><span class="n">old</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">new_av</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Greedy run 1000 pulls, 2000 experiments</span>
<span class="n">scores_array_average</span> <span class="o">=</span> <span class="n">run_multiple_exp</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">npulls</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nexp</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">scores_array_average</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span><span class="o">=</span><span class="n">scores_array_average</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Line graph&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X axis&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Y axis&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/nov_10_armed_bandit_15_0.png" src="../_images/nov_10_armed_bandit_15_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Explore run 1000 pulls, 2000 experiments</span>
<span class="n">scores_array_average</span> <span class="o">=</span> <span class="n">run_multiple_exp</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">npulls</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">nexp</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">scores_array_average</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span><span class="o">=</span><span class="n">scores_array_average</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Line graph&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X axis&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Y axis&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/nov_10_armed_bandit_16_0.png" src="../_images/nov_10_armed_bandit_16_0.png" />
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chap02"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Helen Duncan<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>